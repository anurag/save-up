test:
	APP_ENV=test cargo test

start:
	DATABASE_URL=$DATABASE_URL sam local start-api -p 4010 --skip-pull-image

build:
	just graphql/build

# cp target/x86_64-unknown-linux-musl/release/authorise bin/

try:
	curl \
		--request POST \
		--header "Content-Type: application/json" \
		--data '{"query": "{__schema{types{name}}}", "variables": {}, "operationName": null}' \
		http://127.0.0.1:4010/graphql

invoke-migration:
	curl \
		--request POST \
		http://127.0.0.1:4010/migrate

package:
	sam package \
		--template-file template.yaml \
		--s3-bucket kic-api \
		--output-template-file packaged.yaml

deploy:
	sam deploy \
		--template-file ./packaged.yaml \
		--stack-name kic-api \
		--capabilities CAPABILITY_IAM
