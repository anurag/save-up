up:
  diesel migration run

up-test:
  DATABASE_URL=$DATABASE_URL_TEST diesel migration run

setup-test:
  DATABASE_URL=$DATABASE_URL_TEST diesel setup

schema:
  diesel print-schema > src/models/schema.rs

build:
  cargo build

build-release:
  docker build \
    -f Dockerfile.release \
    -t kic-api .

  docker run \
    -it -v $PWD:/volume kic-api \
    cargo build -Z unstable-options --release --out-dir /volume/bin

# cargo build -Z unstable-options --release --out-dir /volume/bin

# cp ./target/x86_64-unknown-linux-musl/release/api ./bin/api

# env OPENSSL_DIR=/usr/local/ssl OPENSSL_LIB_DIR=/usr/local/lib OPENSSL_INCLUDE_DIR=/usr/local/include \

# cargo build --release --target=x86_64-unknown-linux-musl

# docker run \
#   -it -v "$(pwd):/usr/src/kic" kic-api \
#   env OPENSSL_LIB_DIR=/usr/local/lib/ OPENSSL_INCLUDE_DIR=/usr/local/include OPENSSL_STATIC=yes cargo build --release --target=x86_64-unknown-linux-musl

deploy:
  git push heroku master

# Shell into the Docker release container
sh:
  docker run -i -t --entrypoint /bin/bash kic-api

run: build
  cargo run

start:
  cargo watch -x run

test:
  APP_ENV=test cargo test

